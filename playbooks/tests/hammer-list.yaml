---
- hosts: satellite6
  gather_facts: False
  tasks:
    - name: "Run 'hammer host list' command"
      ansible.builtin.shell:
        hammer -u "{{ sat_user }}" -p "{{ sat_pass }}" host list --organization "{{ organization }}" --page 1 --per-page 100 >/dev/null
      register: run_hammer
      loop: "{{ range(30)|list }}"
      environment:
        TZ: UTC

    - name: "Calculate command duration"
      ansible.builtin.set_fact:
        run_hammer_duration: "{{ (run_hammer.end | to_datetime('%Y-%m-%d %H:%M:%S.%f')).timestamp() - (run_hammer.start | to_datetime('%Y-%m-%d %H:%M:%S.%f')).timestamp() }}"

    - name: "Print results"
      ansible.builtin.debug:
        msg: "HammerHostList {{ item.start }} to {{ item.end }} taking {{ run_hammer_duration }} seconds"
      loop: "{{ run_hammer.results }}"
